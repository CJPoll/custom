#compdef prep-stack

# Completion function for prep-stack command

# Function to get Graphite-tracked branches
_prep_stack_tracked_branches() {
  local -a branches
  if command -v gt &>/dev/null; then
    # Get tracked branches from Graphite, excluding graphite-base/* branches
    branches=(${(f)"$(gt ls --no-interactive 2>/dev/null | grep -E '[◯◉]' | sed -E 's/^[│◯◉[:space:]]*//' | grep -v '^graphite-base/' | grep -v '^main$\|^master$')"})
    _describe 'tracked branch' branches
  else
    _message 'Graphite (gt) not installed'
  fi
}

_arguments \
  '(--stack-top)--stack-top[Top-most branch of the stack to prepare]:branch:_prep_stack_tracked_branches' \
  '(--stack-bottom)--stack-bottom[Only check branches from this branch onwards]:branch:_prep_stack_tracked_branches' \
  '(-h --help)'{-h,--help}'[Show help message]' \
  '1:branch (stack-top):_prep_stack_tracked_branches'
